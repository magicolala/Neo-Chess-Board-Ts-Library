<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Explore Neo Chess Board advanced features: arrows, highlights, premoves, state export, and keyboard shortcuts."
    />
    <script type="importmap">
      {
        "imports": {
          "chess.js": "https://esm.sh/chess.js@1.0.0-beta.8"
        }
      }
    </script>
    <link rel="stylesheet" href="/assets/tailwind.css" />
    <title>Neo Chess Board - Advanced Features</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
      }

      .language-row {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 20px;
      }

      .language-toggle {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.4);
        color: white;
        padding: 8px 16px;
        border-radius: 999px;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .language-toggle:hover {
        transform: translateY(-1px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
      }

      .language-toggle:active {
        transform: translateY(0);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 30px;
        align-items: start;
      }

      .board-container {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 16px;
        backdrop-filter: blur(10px);
      }

      .board-wrapper {
        width: 500px;
        height: 500px;
        margin: 0 auto;
      }

      .controls {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 16px;
        backdrop-filter: blur(10px);
      }

      .control-group {
        margin-bottom: 20px;
      }

      .control-group h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
        color: #e2e8f0;
      }

      button {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        margin: 4px;
        transition: all 0.2s;
      }

      button:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .instructions {
        background: rgba(0, 0, 0, 0.2);
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-size: 14px;
        line-height: 1.6;
      }

      .status {
        margin-top: 20px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        font-size: 14px;
      }

      h1 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 28px;
      }

      h2 {
        margin: 0 0 15px 0;
        font-size: 18px;
      }

      @media (max-width: 960px) {
        .container {
          grid-template-columns: 1fr;
        }

        .board-wrapper {
          width: 100%;
          height: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="language-row">
      <button id="language-toggle" class="language-toggle" data-i18n="language.toggle.fr"></button>
    </div>
    <div class="container">
      <div class="board-container">
        <h1 data-i18n="heading.title">üéØ Advanced features demo</h1>
        <div class="board-wrapper">
          <div id="board" data-i18n-attr="aria-label:board.ariaLabel" aria-label="Interactive board"></div>
        </div>
      </div>

      <div class="controls">
        <h2 data-i18n="controls.title">‚ú® New features</h2>

        <div class="control-group">
          <h3 data-i18n="controls.arrows.title">üèπ Arrows</h3>
          <button onclick="window.addSampleArrow()" data-i18n="controls.arrows.addSample">Add arrow e2‚Üíe4</button>
          <button onclick="window.addColoredArrow()" data-i18n="controls.arrows.addRed">Add red arrow d1‚Üíd8</button>
          <button onclick="window.board.clearArrows()" data-i18n="controls.arrows.clear">Clear arrows</button>
        </div>

        <div class="control-group">
          <h3 data-i18n="controls.highlights.title">üé® Highlights</h3>
          <button onclick="window.addHighlight('e5', 'green')" data-i18n="controls.highlights.addGreen">Highlight e5 (green)</button>
          <button onclick="window.addHighlight('d4', 'red')" data-i18n="controls.highlights.addRed">Highlight d4 (red)</button>
          <button onclick="window.addHighlight('f6', 'blue')" data-i18n="controls.highlights.addBlue">Highlight f6 (blue)</button>
          <button onclick="window.board.clearHighlights()" data-i18n="controls.highlights.clear">Clear highlights</button>
        </div>

        <div class="control-group">
          <h3 data-i18n="controls.premoves.title">‚ö° Premoves</h3>
          <button onclick="window.setPremoveExample()" data-i18n="controls.premoves.setExample">Set premove g1‚Üíf3</button>
          <button onclick="window.board.clearPremove()" data-i18n="controls.premoves.clear">Clear premove</button>
          <button onclick="window.showPremoveStatus()" data-i18n="controls.premoves.show">Show premove status</button>
        </div>

        <div class="control-group">
          <h3 data-i18n="controls.game.title">üéÆ Game control</h3>
          <button
            onclick="window.board.setPosition('rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1')"
            data-i18n="controls.game.reset"
          >
            Reset board
          </button>
          <button
            onclick="window.board.setPosition('rnbqkb1r/pppp1ppp/5n2/4p3/2B1P3/8/PPPP1PPP/RNBQK1NR w KQkq - 4 4')"
            data-i18n="controls.game.test"
          >
            Test position
          </button>
          <button onclick="window.board.clearAllDrawings()" data-i18n="controls.game.clearDrawings">Clear all drawings</button>
        </div>

        <div class="control-group">
          <h3 data-i18n="controls.state.title">üíæ State management</h3>
          <button onclick="window.exportDrawings()" data-i18n="controls.state.export">Export state</button>
          <button onclick="window.importDrawings()" data-i18n="controls.state.import">Import state</button>
        </div>

        <div class="instructions">
          <h3 data-i18n="instructions.title">üìñ Instructions</h3>
          <ul data-i18n-html="instructions.items">
            <li><strong>Right-click + drag</strong> to draw arrows between squares.</li>
            <li><strong>Right-click</strong> a square to cycle highlight colors.</li>
            <li>Use premoves while it's not your turn to queue the next move.</li>
            <li>Press <strong>Escape</strong> to cancel the current drawing action.</li>
          </ul>
        </div>

        <div class="status" id="status" data-i18n="status.ready">Ready to test advanced features!</div>
      </div>
    </div>

    <script type="module">
      import { setupI18n } from './i18n.js';
      import { NeoChessBoard } from '../index.js';

      const i18n = setupI18n('advanced');
      const { translate } = i18n;

      const languageToggle = document.getElementById('language-toggle');
      const statusElement = document.getElementById('status');

      const statusState = {
        key: 'status.ready',
        replacements: undefined,
      };

      const renderStatus = () => {
        statusElement.textContent = translate(statusState.key, statusState.replacements);
      };

      const updateStatus = (key, replacements) => {
        statusState.key = key;
        statusState.replacements = replacements;
        renderStatus();
        setTimeout(() => {
          statusState.key = 'status.ready';
          statusState.replacements = undefined;
          renderStatus();
        }, 3000);
      };

      const updateLanguageToggle = () => {
        const key = i18n.getLanguage() === 'en' ? 'language.toggle.fr' : 'language.toggle.en';
        languageToggle.textContent = translate(key);
      };

      languageToggle.addEventListener('click', () => {
        const nextLanguage = i18n.getLanguage() === 'en' ? 'fr' : 'en';
        i18n.setLanguage(nextLanguage);
        updateLanguageToggle();
        renderStatus();
      });

      updateLanguageToggle();
      renderStatus();

      window.board = new NeoChessBoard(document.getElementById('board'), {
        theme: 'classic',
        orientation: 'white',
        interactive: true,
        showCoordinates: true,
        highlightLegal: true,
        animationMs: 300,
        allowPremoves: true,
        showArrows: true,
        showHighlights: true,
        rightClickHighlights: true,
      });

      window.board.on('move', (data) => {
        updateStatus('status.move', { from: data.from, to: data.to });
      });

      window.board.on('illegal', (data) => {
        updateStatus('status.illegal', { from: data.from, to: data.to, reason: data.reason });
      });

      window.addSampleArrow = () => {
        window.board.addArrow({
          from: 'e2',
          to: 'e4',
          color: '#ffeb3b',
          width: 4,
          opacity: 0.8,
        });
        updateStatus('status.arrowSample');
      };

      window.addColoredArrow = () => {
        window.board.addArrow({
          from: 'd1',
          to: 'd8',
          color: '#f44336',
          width: 5,
          opacity: 0.9,
        });
        updateStatus('status.arrowRed');
      };

      window.addHighlight = (square, type) => {
        window.board.addHighlight({
          square,
          type,
          opacity: 0.7,
        });
        updateStatus('status.highlight', { square, type });
      };

      window.setPremoveExample = () => {
        window.board.setPremove({
          from: 'g1',
          to: 'f3',
        });
        updateStatus('status.premoveSet');
      };

      window.showPremoveStatus = () => {
        const premove = window.board.getPremove();
        if (premove) {
          updateStatus('status.premoveCurrent', { from: premove.from, to: premove.to });
        } else {
          updateStatus('status.premoveNone');
        }
      };

      window.exportDrawings = () => {
        const state = window.board.exportDrawings();
        localStorage.setItem('neo-chess-drawings', state);
        updateStatus('status.exported');
      };

      window.importDrawings = () => {
        const state = localStorage.getItem('neo-chess-drawings');
        if (state) {
          window.board.importDrawings(state);
          updateStatus('status.imported');
        } else {
          updateStatus('status.noSaved');
        }
      };

      console.log('Advanced features demo loaded!');
    </script>
  </body>
</html>
