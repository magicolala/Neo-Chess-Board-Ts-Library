import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const cssModules = ['demo/App.module.css'];

for (const cssModule of cssModules) {
  const cssPath = path.resolve(__dirname, '..', cssModule);
  const dtsPath = `${cssPath}.d.ts`;

  // Read the CSS file
  const cssContent = fs.readFileSync(cssPath, 'utf8');

  // Extract class names using a simple regex
  const classNames = [];
  const classRegex = /\.([a-zA-Z0-9_-]+)/g;
  let match;

  while ((match = classRegex.exec(cssContent)) !== null) {
    const className = match[1];
    if (!className.startsWith('_') && !classNames.includes(className)) {
      classNames.push(className);
    }
  }

  // Generate the type definition content
  const typeDefinition = `// This file is automatically generated.
// Please do not change this file!
declare const styles: {
${classNames.map((className) => `  readonly '${className}': string;`).join('\n')}
};

export default styles;
`;

  // Write the type definition file
  fs.writeFileSync(dtsPath, typeDefinition);
  console.log(`Generated ${dtsPath}`);
}
